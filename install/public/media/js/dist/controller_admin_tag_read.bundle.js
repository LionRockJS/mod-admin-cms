(()=>{"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,"string");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===t(n)?n:String(n)}function a(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t,a){return(t=n(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=function(){function t(){e(this,t)}return o(t,null,[{key:"init",value:function(){var e=this;if(!this.isInit){this.isInit=!0;var t=document.querySelector("html").getAttribute("lang");document.querySelectorAll(".pagefield-page").forEach((function(n){var a=n.getAttribute("data-page-type"),o=n.querySelector(".pagefield-page-input"),i=n.querySelector(".pagefield-page-value"),r=n.querySelector(".pagefield-page-badges"),c=e.fetchPageList(a,t);o.addEventListener("change",(function(){var t=c.querySelector('option[value="'.concat(o.value,'"]'));if(o.value="",t){var n=t.getAttribute("data-id");i.value.split(",").includes(n)||(e.addPageBadge(r,n,i,c),e.updatePageInputValue(i,r))}})),i.value.split(",").forEach((function(t){t&&e.addPageBadge(r,t,i,c)})),new Sortable(r,{animation:150,ghostClass:"opacity-50",onEnd:function(){return e.updatePageInputValue(i,r)}})}))}}},{key:"updatePageInputValue",value:function(e,t){var n=t.querySelectorAll(".badge"),a=Array.from(n).map((function(e){return e.getAttribute("data-page-id")}));e.value=a.join(",")}},{key:"addPageBadge",value:function(e,t,n,a){var o,i=this,r=document.createElement("span"),c=(null===(o=a.querySelector('option[data-id="'.concat(t,'"]')))||void 0===o?void 0:o.value)||t;r.setAttribute("data-page-id",t),r.classList.add("badge","bg-primary","rounded-pill"),r.innerHTML="".concat(c,' <i class="fas fa-times"></i>'),r.addEventListener("click",(function(){r.remove(),i.updatePageInputValue(n,e)})),e.append(r)}},{key:"sort",value:function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}},{key:"fetchPageList",value:function(e,t){var n=this,a="page-list-".concat(e),o=document.querySelector("#".concat(a));if(o)return o;var i=document.createElement("datalist");return i.id=a,document.body.appendChild(i),fetch("/admin/api/pages/".concat(e,"?language=").concat(t)).then((function(e){e.json().then((function(e){i.innerHTML=e.sort(n.sort).map((function(e){return document.querySelectorAll('.badge[data-page-id="'.concat(e.page,'"]')).forEach((function(t){t.innerHTML="".concat(e.name,' <i class="fas fa-times"></i>')})),'<option value="'.concat(e.name,'" data-id="').concat(e.page,'" />')})).join("\n")}))})),i}}]),t}();i(r,"isInit",!1),i(r,"pages",new Map),function(){function t(){e(this,t)}return o(t,null,[{key:"enableAutoSave",value:function(){var e=document.getElementById("autosave");e&&e.addEventListener("change",(function(e){e.currentTarget.form.submit()}))}},{key:"enablePageInput",value:function(){r.init()}},{key:"enablePointers",value:function(){var e=document.querySelector("html").getAttribute("lang");document.querySelectorAll("select.ref-pages").forEach((function(t){var n=t.getAttribute("data-pagetype");fetch("/admin/api/pages/".concat(n,"?language=").concat(e)).then((function(e){e.json().then((function(e){console.log(e)}))})),console.log(t)})),document.querySelectorAll("select.ref-page-items").forEach((function(t){var n=t.innerHTML,a=t.getAttribute("data-value"),o=t.getAttribute("data-pagetype"),i=t.getAttribute("data-item"),r="/admin/api/page-items/".concat(o,"/").concat(i,"?language=").concat(e);t.innerHTML='<option value="">Loading...</option>',fetch(r).then((function(e){e.json().then((function(e){var o=[n];e.forEach((function(e){o.push('<optgroup label="'.concat(e.name,'">')),e.items.forEach((function(e){o.push('<option value="'.concat(e.id,'" ').concat(e.id.toString()===a?"selected":"",">").concat(e.name,"</option>"))})),o.push("</optgroup>")})),t.innerHTML=o.join("/n")}))}))}))}},{key:"enableBlock",value:function(){var e=document.getElementById("add-block");if(e){var t=e.querySelector("select"),n=e.querySelector("a");t.addEventListener("change",(function(){n.setAttribute("href",n.getAttribute("data-link").replace("[block_name]",t.value))}))}}},{key:"addPageTag",value:function(e,t,n){fetch("/admin/api/page/".concat(e,"/tag/").concat(t),{credentials:"include",method:"POST"}).then((function(e){return e.json().then((function(e){console.log(e),!0===e.payload.success&&n(e.payload)}))}))}},{key:"enablePageTag",value:function(){var e=this;document.querySelectorAll(".page-tag-form").forEach((function(t){var n=t.getAttribute("data-page"),a=t.querySelector(".tag-add-input"),o=t.querySelector(".page-tag-list"),i=function(e){var t=e.currentTarget;fetch("/admin/api/page_tag/".concat(t.getAttribute("data-id")),{credentials:"include",method:"DELETE"}).then((function(e){return e.json().then((function(e){console.log(e),t.remove()}))}))};t.querySelector(".toggle-input-tag").addEventListener("click",(function(e){a.classList.contains("visually-hidden")?a.classList.remove("visually-hidden"):a.classList.add("visually-hidden")})),t.querySelectorAll(".page-tag.badge").forEach((function(e){e.addEventListener("click",i)})),a.addEventListener("change",(function(){var r=t.querySelector('option[value="'.concat(a.value,'"]'));if(r){var c=r.getAttribute("data-id"),u=r.getAttribute("data-value"),l=r.getAttribute("data-name");e.addPageTag(n,c,(function(e){var t=document.createElement("span");t.value="".concat(u," ( ").concat(l," )"),t.setAttribute("data-id",e.id),t.setAttribute("role","button"),t.classList.add("badge","bg-primary","rounded-pill"),t.innerHTML="".concat(u,' <i class="fas fa-times"></i>'),o.appendChild(t),o.appendChild(document.createTextNode(" ")),a.value="",t.addEventListener("click",i)}))}}))}))}}]),t}().enableAutoSave(),document.querySelectorAll(".page-field-auto-complete").forEach((function(e){var t=e.querySelector(".page-field-auto-complete-search"),n=e.querySelector(".page-field-auto-complete-value");t.addEventListener("change",(function(){var a=e.querySelector('option[value="'.concat(t.value,'"]'));n.value=a?a.getAttribute("data-id"):""}))}))})();
//# sourceMappingURL=controller_admin_tag_read.bundle.js.map